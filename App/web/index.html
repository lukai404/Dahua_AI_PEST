<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <META http-equiv="X-UA-Compatible" content="IE=8">
    <title>SDEV 模板HTML</title>
    <link rel="stylesheet" href="./js/bootstrap-3.3.7-dist/css/bootstrap.css">
    <script src="./js/jquery-3.5.1/jquery.min.js"></script>
    <script src="./js/bootstrap-3.3.7-dist/js/bootstrap.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./js/foundation-5.5.3/css/foundation.css">
    <script src="./js/foundation-5.5.3/js/foundation.min.js"></script>
    <script src="./js/foundation-5.5.3/js/modernizr.js"></script>

    <link rel="stylesheet" href="./js/bootstrap-select-1.13.9/css/bootstrap-select.min.css">
    <script src="./js/bootstrap-select-1.13.9/js/bootstrap-select.min.js"></script>
    <script src="./js/bootstrap-select-1.13.9/js/i18n/defaults-zh_CN.min.js"></script>

    <style type="text/css">
        html,
        body {
            background: #d5d5d5;
        }

        /*reset*/
        ul,
        li {
            padding: 0px;
            margin: 0px;
            list-style: none;
        }

        .div_form {
            position: absolute;
            left: 550px;
            top: 70px;
            width: 350px;
        }

        /*fn*/
        .fn-height40 {
            height: 40px;
        }

        .fn-left {
            float: left;
        }

        .fn-hide {
            display: none;
        }

        /*main*/
        .top {
            font-size: 20px;
        }

        .main {
            padding-top: 8px;
            padding-left: 0px;
        }

        .login-wrap li {
            float: left;
            margin-left: 40px;
        }

        .login-wrap li span {
            float: left;
            width: 80px;
        }

        .video-wrap {
            width: 540px;
            height: 380px;
            background: #000;
        }

        .btn-wrap {
            margin-left: 20px;
        }

        .btn-input {
            width: 100px;
        }

        .draw_btn_selected {
            background-color: rgb(95, 185, 77);
        }

        .show-text {
            border: 1px solid #ccc;
            height: 200px;
            width: 500px;
            margin: 10px 0;
            overflow: scroll;
        }

        #sdev_video_loading {
            width: 540px;
            height: 380px;
            background: #000;
            color: #fff;
            margin-top: -380px;
            line-height: 380px;
            text-align: center;
            font-size: 50px;
        }

        .todo_node {
            color: #ec5d57;
            font-weight: bold;
            border: 1px solid #eeeeee;
            margin: 2px;
            border-radius: 1rem;
            padding-left: 3px;
            padding-right: 3px;
            padding-top: 1px;
            padding-bottom: 1px;
            background-color: #e2e2e2;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">PestDector</a>
            </div>
            <div>
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#base_cfg" data-toggle="tab">控制页面</a></li>
                    <li><a href="#conn_cfg" data-toggle="tab">配置页面</a></li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">更多...<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="#log_dump" data-toggle="tab">日志</a></li>
                            <li><a href="#module_update" data-toggle="tab">模型更新<span class="todo_node">未实现</span></a></li>
                            <li class="divider"></li>
                            <li><a href="#auth_info" data-toggle="tab">作者信息</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="tab-content">
        <div class="tab-pane fade in active" id="base_cfg">
            <div class="fn-left">
                <div id="sdev_stream_wrap"></div>
                <div id="sdev_video_loading">loading..</div>
            </div>
            <div class="div_form">
                <form class="form-horizontal" id="config_form" role="form" action="#" method="POST">

                    <div class="form-group">
                        <div class="col-sm-12 col-sm-offset-3">
                            <button type="button" id="start_cruise"
                                class="btn btn-info col-sm-4">开始巡航</button>
                            <button type="button" id="stop_cruise"
                                class="btn btn-default col-sm-offset-1 col-sm-4">停止巡航</button>
                            <button type="button" id="set_Home"
                                class="btn btn-default col-sm-offset-1 col-sm-4">设置HOME点</button>
                        </div>
                    </div>
                    <div id="showResult"></div>
                </form>
            </div>
        </div>
        <div class="tab-pane fade" id="conn_cfg">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        详细配置
                    </h3>
                </div>
                <div class="panel-body">
                    <form class="form-horizontal" id="connect_cfg_form" role="form" action="#" method="POST">
                        <div class="form-group">
                            <label for="ip" class="col-sm-1 control-label">主机IP地址</label>
                            <div class="col-sm-4">
                                <input type="text" class="form-control itop_english_name" name="ip" id="ip"
                                    autocomplete="on" placeholder="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="port" class="col-sm-1 control-label">端口号</label>
                            <div class="col-sm-4">
                                <input type="text" class="form-control" name="port" id="port" autocomplete="on"
                                    placeholder="3000">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="height" class="col-sm-1 control-label">球机高度</label>
                            <div class="col-sm-4">
                                <input type="text" class="form-control" name="height" id="height" autocomplete="on"
                                    placeholder="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="cruise_speed" class="col-sm-1 control-label">巡航速度</label>
                            <div class="col-sm-4">
                                <input type="text" class="form-control" name="cruise_speed" id="cruise_speed" autocomplete="on"
                                    placeholder="">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-1 col-sm-4">
                                <button type="button" id="connect_form_submit_btn"
                                    class="btn btn-info col-sm-5">提交</button>
                                <button type="button" id="connect_form_reset_btn"
                                    class="btn btn-default col-sm-offset-2 col-sm-5">重置</button>
                            </div>
                        </div>
                        <div id="showResult1"></div>
                    </form>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="log_dump">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        日志配置
                    </h3>
                </div>
                <div class="panel-body">
                    <form class="form-horizontal" id="log_cfg_form" role="form" action="#" method="POST">
                        <div class="form-group">
                            <label class="col-sm-3 control-label">检测目标</label>
                            <div class="col-sm-9">
                                <select id="logLevel" name="logLevel" class="selectpicker" data-width="255px">
                                    <option value="3">DEBUG</option>
                                    <option value="2">INFO</option>
                                    <option value="1">WARNING</option>
                                    <option value="0">ERROR</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-1 col-sm-4">
                                <button type="button" id="log_form_submit_btn"
                                    class="btn btn-info col-sm-5">提&nbsp;交</button>
                                <button type="button" id="log_form_reset_btn"
                                    class="btn btn-default col-sm-offset-2 col-sm-5">重&nbsp;置</button>
                            </div>
                        </div>
                        <div id="showResult2"></div>
                    </form>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="module_update">模型更新</div>
        <div class="tab-pane fade" id="auth_info">
            <table class="table table-hover">
                <caption>作者信息</caption>
                <thead>
                    <tr>
                        <th>姓名</th>
                        <th>地址</th>
                        <th>联系方式</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>卢恺</td>
                        <td>北京邮电大学</td>
                        <td>lukai404@163.com</td>
                    </tr>
                </tbody>
            </table>

        </div>
    </div>
    <div class="top fn-height40" id="top_tip" style="display: none;"></div>
    <div class="main" style="display: none;">
        <div class="btn-wrap fn-left">
            <div class="btn-item">
                <button needinput="true" id="OpenIvsEnable" title="开启预览IVS">开启预览IVS</button>
            </div>
            <div class="btn-item">
                <button needinput="true" id="CloseIvsEnable" title="关闭预览IVS">关闭预览IVS</button>
            </div>
        </div>
        <div class="btn-wrap fn-left">
            <div id="btn_wrap ">
                <div class="btn-item">
                    <input class="btn-input" placeholder="输入标题" id="input_title">
                </div>
                <div class="btn-item">
                    <button needinput="true" id="DrawVertLine" title="绘制垂直线，指定标题">绘制垂直线</button>
                </div>
                <div class="btn-item">
                    <button needinput="true" id="DrawHorizLine" title="绘制水平线，指定标题">绘制水平线</button>
                </div>
                <div class="btn-item">
                    <button needinput="true" id="DrawLine" title="绘制直线，指定标题">绘制直线</button>
                </div>
                <div class="btn-item">
                    <button needinput="true" id="DrawPolyLine" title="绘制折线，指定标题">绘制折线</button>
                </div>
                <div class="btn-item">
                    <button needinput="true" id="DrawRectangle" title="绘制矩形框，指定标题">绘制矩形框</button>
                </div>
                <div class="btn-item">
                    <button needinput="true" id="DrawPolygon" title="绘制多边形框，指定标题">绘制多边形框</button>
                </div>

            </div>
            <div class="show-text">
                <pre id="text_btn_GetActiveObjType"></pre>
            </div>
            <div id="btn_wrap_ex">
                <fieldset>
                    <legend>复合操作</legend>
                    <div class="btn-item">
                        <select id="select_data"></select>
                        <button id="RemoveObjById" title="移除指定ID的对象">移除指定ID的对象</button>
                        <button id="SetActiveObj" title="设置指定ID的对象为活动对象，并颜色高亮">设置指定ID的对象为活动对象</button>
                    </div>
                    <div class="btn-item">
                        <input id="input_SetText">
                        <button id="SetText" title="设置指定ID的对象的标题">设置指定ID的对象的标题</button>
                    </div>
                </fieldset>
                <button id="RemoveActiveObj">移除当前活动对象</button>
                <button id="GetActiveObject">获取当前处于活动状态的对象</button>
                <button id="removeShapeDrawEvent">关闭绘制</button>
            </div>
        </div>
    </div>
    <div id="script_wrap"></div>
    <script type="text/javascript">

        var DEVELOPENV = true; // 标识是否是脱离设备的开发环境， true是开发环境，false是生产环境
        // 开发环境下才需要执行此处代码
        void function (isDevelop, cb) {
            var locationObj = top.location || window.location;
            var baseUrl = locationObj.protocol + '//' + locationObj.hostname + ':' + locationObj.port + '/';

            var libjsArr = [
                //"jsBase/lib/jquery.js",
                //"js/jquery-3.5.1/jquery.min.js",
                //"js/bootstrap-3.3.7-dist/js/bootstrap.js",
                "jsBase/lib/sea.js",
                "jsBase/lib/seajs-text.js",
                "jsBase/lib/md5.js",
                "jsBase/lib/base64.js",
                "module/public.js",
                "module/Sylvester.js"
            ];

            // ie下不需要加载无插件解码库
            if ('ActiveXObject' in window) {
                // do nothing
            } else {
                libjsArr = libjsArr.concat([
                    "module/mp4remux.js",
                    "module/WebGLCanvas.js",
                    "module/audioPlayer.js",
                    "module/streamDrawer.js",
                    "module/videoMediaSource.js",
                    "module/workerManager.js",
                    "module/WebsocketServer.js",
                    "module/playerControl.js"
                ]);
            }

            libjsArr.push("module/ivs.js");

            if (isDevelop) { // 开发环境需要执行一堆前置代码
                libjsArr.push("sdevCore/SDEV.js");
            } else {
                // 非开发环境，只需要加载SDEV前置代码
                libjsArr = ["sdevCore/SDEV.js"];
            };
            function loadScript(path) {

                if (!path) { // 前置代码加载完了
                    return cb && cb();
                };
                var script = document.createElement('script');
                script.src = baseUrl + path;
                script.setAttribute('type', "text/javascript");

                document.body.appendChild(script);

                if (typeof script.onload == 'object') {
                    script.onload = function () {
                        loadScript(libjsArr.shift());
                    }
                } else if (typeof script.onreadystatechange == 'object') {
                    // ie下加载文件
                    script.onreadystatechange = function () {
                        if (script.readyState == 'loaded' || script.readyState == 'complete') {
                            loadScript(libjsArr.shift());
                            script.onreadystatechange = null;
                        }
                    }
                }
            }

            loadScript(libjsArr.shift());
        }(DEVELOPENV, userCodeRun);

        // 客户需要执行的代码，都放在这个userCodeRun里面，或者可以参考这这个demo示例，自行修改
        function userCodeRun() {
            // 需要执行的客户的代码
            var usersScript = document.createElement('script');
            usersScript.src = "ijs/cavans.js";
            document.body.appendChild(usersScript);
        }
        // 通过URL中的信息，获取到对应的APP名称
        function getAppName() {
            var url = window.location.href;
            var array = url.split("://", 2);
            var str = array[1]
            var name = str.split("/", 5)

            return name[1]
        }
        // 通过URL中的信息，获取到当前交互的Session值
        function getSession() {
            var url = window.location.href;
            var index = url.indexOf("session");
            var params = url.substr(index);
            var sessionStr = params.split("&")[0];
            var session = sessionStr.split("=")[1];

            return session
        }

        // 点击提交按钮后，如果成功会有提示框出现，定时3秒后出发这里将提示框消失
        var g_timer1 = null;
        function hideResultInfo() {
            if (g_timer1 != null) {
                clearInterval(g_timer1);
                g_timer1 = null;
            }
            $("#showResult").html("");
            $("#showResult1").html("");
            $("#showResult2").html("");
        }

        // 文件加载完成后，自动执行这里的代码
        $(function () {

            // 点击绘制检测区后，出发绘制功能
            $("#detect_region_btn").click(function () {
                //$("#detect_region_btn").addClass("draw_btn_selected");
                $("#min_region_btn").removeClass("draw_btn_selected");
                //document.getElementById('detect_region').value = "";
                //DHOP_JS_DrawDetRegion();
                DHOP_JS_AdjustRegion(2); // 检测框用调整的方法
            });

            // 点击绘制检测区后，出发绘制功能
            $("#min_region_btn").click(function () {
                $("#min_region_btn").addClass("draw_btn_selected");
                //$("#detect_region_btn").removeClass("draw_btn_selected");
                document.getElementById('min_size').value = "";
                DHOP_JS_DrawMinRegion(); // 最小框用绘制的方法
                //DHOP_JS_AdjustRegion(1);
            });
            $("#log_form_submit_btn").click(function () {
                var req_url = window.location.origin + "/DHOP_API/" + getAppName() + "/setConfig" + "?t=1&session=" + getSession();

                if (g_timer1 != null) {
                    clearInterval(g_timer1);
                    g_timer1 = null;
                }

                $.ajax({
                    url: req_url,
                    type: "post",
                    dataType: "json",
                    data: $("#log_cfg_form").serialize(),
                    error: function (xhr) {
                        // 提交成功后，弹出提示框，并触发1500ms的定时任务
                        $("#showResult2").html("<div class=\"alert alert-warning\"><a href=\"#\" class=\"close\" data-dismiss=\"alert\">&times;</a><strong>警告！</strong>保持配置出错。</div>");
                        g_timer1 = setInterval("hideResultInfo()", 1500);
                    },
                    success: function (response, status, xhr) {
                        // 提交成功后，弹出提示框，并触发1500ms的定时任务
                        $("#showResult2").html("<div class=\"alert alert-success\"><a href=\"#\" class=\"close\" data-dismiss=\"alert\">&times;</a><strong>成功！</strong>已正确下发配置。</div>");
                        g_timer1 = setInterval("hideResultInfo()", 1500);
                    }
                });
            });
            // 点击恢复按钮，参数回复默认
            $("#log_form_reset_btn").click(function () {
                DHOP_JS_getCurrentConfig();
            });
            //点击配置页面的提交按钮
            $("#connect_form_submit_btn").click(function () {
                var req_url = window.location.origin + "/DHOP_API/" + getAppName() + "/setConfig" + "?t=2&session=" + getSession();
                alert(req_url);
                if (g_timer1 != null) {
                    clearInterval(g_timer1);
                    g_timer1 = null;
                }
                const formSerializedData = $("#connect_cfg_form").serialize();
                alert(formSerializedData);
                $.ajax({
                    url: req_url,
                    type: "post",
                    dataType: "json",
                    data: $("#connect_cfg_form").serialize(),
                    error: function (xhr) {
                        // 提交成功后，弹出提示框，并触发1500ms的定时任务
                        $("#showResult1").html("<div class=\"alert alert-warning\"><a href=\"#\" class=\"close\" data-dismiss=\"alert\">&times;</a><strong>警告！</strong>保持配置出错。</div>");
                        g_timer1 = setInterval("hideResultInfo()", 1500);
                    },
                    success: function (response, status, xhr) {
                        // 提交成功后，弹出提示框，并触发1500ms的定时任务
                        $("#showResult1").html("<div class=\"alert alert-success\"><a href=\"#\" class=\"close\" data-dismiss=\"alert\">&times;</a><strong>成功！</strong>已正确下发配置。</div>");
                        g_timer1 = setInterval("hideResultInfo()", 1500);
                    }
                });
            });
            // 点击恢复按钮，参数回复默认
            $("#connect_form_reset_btn").click(function () {
                DHOP_JS_getCurrentConfig();
            });
            // 点击提交按钮，下发参数到设备中
            $("#form_submit_btn").click(function () {
                var req_url = window.location.origin + "/DHOP_API/" + getAppName() + "/setConfig" + "?t=3&session=" + getSession();
                alert(req_url);
                if (g_timer1 != null) {
                    clearInterval(g_timer1);
                    g_timer1 = null;
                }

                $.ajax({
                    url: req_url,
                    type: "post",
                    dataType: "json",
                    data: $("#config_form").serialize(),
                    error: function (xhr) {
                        // 提交成功后，弹出提示框，并触发1500ms的定时任务
                        $("#showResult").html("<div class=\"alert alert-warning\"><a href=\"#\" class=\"close\" data-dismiss=\"alert\">&times;</a><strong>警告！</strong>保持配置出错。</div>");
                        g_timer1 = setInterval("hideResultInfo()", 1500);
                    },
                    success: function (response, status, xhr) {
                        // 提交成功后，弹出提示框，并触发1500ms的定时任务
                        $("#showResult").html("<div class=\"alert alert-success\"><a href=\"#\" class=\"close\" data-dismiss=\"alert\">&times;</a><strong>成功！</strong>已正确下发配置。</div>");
                        g_timer1 = setInterval("hideResultInfo()", 1500);
                    }
                });
            });
            //点击“开始巡航”按钮，开启巡航
            $("#start_cruise").click(function(){
                var req_url = window.location.origin + "/DHOP_API/"+ getAppName()+"/startCruise"+"?t=3&session="+getSession();
                if (g_timer1 != null) {
                    clearInterval(g_timer1);
                    g_timer1 = null;
                }
                $.ajax({
                    url:req_url,
                    type:"post",
                    dataType:"json",
                    data: $("#config_form").serialize(),
                    error: function (xhr) {
                        // 提交成功后，弹出提示框，并触发1500ms的定时任务
                        $("#showResult").html("<div class=\"alert alert-warning\"><a href=\"#\" class=\"close\" data-dismiss=\"alert\">&times;</a><strong>错误！</strong>启动巡航失败。</div>");
                        g_timer1 = setInterval("hideResultInfo()", 1500);
                    },
                    success: function (response, status, xhr) {
                        // 提交成功后，弹出提示框，并触发1500ms的定时任务
                        $("#showResult").html("<div class=\"alert alert-success\"><a href=\"#\" class=\"close\" data-dismiss=\"alert\">&times;</a><strong>成功！</strong>已开始巡航。</div>");
                        g_timer1 = setInterval("hideResultInfo()", 1500);
                    }
                })
            });
            //点击“停止巡航”按钮，停止巡航
            $("#stop_cruise").click(function(){
                var req_url = window.location.origin + "/DHOP_API/"+ getAppName()+"/stopCruise"+"?t=3&session="+getSession();
                if (g_timer1 != null) {
                    clearInterval(g_timer1);
                    g_timer1 = null;
                }
                $.ajax({
                    url:req_url,
                    type:"post",
                    dataType:"json",
                    data: $("#config_form").serialize(),
                    error: function (xhr) {
                        // 提交成功后，弹出提示框，并触发1500ms的定时任务
                        $("#showResult").html("<div class=\"alert alert-warning\"><a href=\"#\" class=\"close\" data-dismiss=\"alert\">&times;</a><strong>错误！</strong>停止巡航失败。</div>");
                        g_timer1 = setInterval("hideResultInfo()", 1500);
                    },
                    success: function (response, status, xhr) {
                        // 提交成功后，弹出提示框，并触发1500ms的定时任务
                        $("#showResult").html("<div class=\"alert alert-success\"><a href=\"#\" class=\"close\" data-dismiss=\"alert\">&times;</a><strong>成功！</strong>已停止巡航。</div>");
                        g_timer1 = setInterval("hideResultInfo()", 1500);
                    }
                })
            });
            //点击“停止巡航”按钮，停止巡航
            $("#set_Home").click(function(){
                var req_url = window.location.origin + "/DHOP_API/"+ getAppName()+"/set_Home"+"?t=3&session="+getSession();
                if (g_timer1 != null) {
                    clearInterval(g_timer1);
                    g_timer1 = null;
                }
                $.ajax({
                    url:req_url,
                    type:"post",
                    dataType:"json",
                    data: $("#config_form").serialize(),
                    error: function (xhr) {
                        // 提交成功后，弹出提示框，并触发1500ms的定时任务
                        $("#showResult").html("<div class=\"alert alert-warning\"><a href=\"#\" class=\"close\" data-dismiss=\"alert\">&times;</a><strong>错误！</strong>设置HOME点失败。</div>");
                        g_timer1 = setInterval("hideResultInfo()", 1500);
                    },
                    success: function (response, status, xhr) {
                        // 提交成功后，弹出提示框，并触发1500ms的定时任务
                        $("#showResult").html("<div class=\"alert alert-success\"><a href=\"#\" class=\"close\" data-dismiss=\"alert\">&times;</a><strong>成功！</strong>已设置HOME点。</div>");
                        g_timer1 = setInterval("hideResultInfo()", 1500);
                    }
                })
            });

            // 点击恢复按钮，参数回复默认
            $("#form_reset_btn").click(function () {
                DHOP_JS_getCurrentConfig();
            });
        });
    </script>
</body>

</html>